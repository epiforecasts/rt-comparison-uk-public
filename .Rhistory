dplyr::left_join(dplyr::select(peak_bind, region, date, source, peak = point),
by = c("region", "date", "source")) %>%
dplyr::left_join(dplyr::select(valley_bind, region, date, source, valley = point),
by = c("region", "date", "source")) %>%
dplyr::group_by(region, source) %>%
dplyr::mutate(date_n = seq_along(date),
peak_valley_type = ifelse(!is.na(peak), peak,
valley),
peak_valley_date = ifelse(!is.na(peak_valley_type), date_n, NA),
valley_group = ifelse(!is.na(valley), date_n, NA)) %>%
tidyr::fill(valley_group, .direction = "up")
waves <- peaks_valleys %>%
group_by(region, source, valley_group) %>%
dplyr::summarise(
n_days = dplyr::n(),
mean_median = mean(median, na.rm=T),
mean_lo95 = mean_median - 1.96 * (sd(median, na.rm=T) / n_days),
mean_hi95 = mean_median + 1.96 * (sd(median, na.rm=T) / n_days))
waves <- peaks_valleys %>%
dplyr::group_by(region, source, valley_group) %>%
dplyr::summarise(
n_days = dplyr::n(),
mean_median = mean(median, na.rm=T),
mean_lo95 = mean_median - 1.96 * (sd(median, na.rm=T) / n_days),
mean_hi95 = mean_median + 1.96 * (sd(median, na.rm=T) / n_days))
View(waves)
dplyr::mutate(valley_group = ifelse(is.na(valley_group), 999, valley_group)
# Join peaks and valleys to full summary data
peaks_valleys <- summary %>%
dplyr::left_join(dplyr::select(peak_bind, region, date, source, peak = point),
by = c("region", "date", "source")) %>%
dplyr::left_join(dplyr::select(valley_bind, region, date, source, valley = point),
by = c("region", "date", "source")) %>%
dplyr::group_by(region, source) %>%
dplyr::mutate(date_n = seq_along(date),
peak_valley_type = ifelse(!is.na(peak), peak,
valley),
peak_valley_date = ifelse(!is.na(peak_valley_type), date_n, NA),
valley_group = ifelse(!is.na(valley), date_n, NA)) %>%
tidyr::fill(valley_group, .direction = "up") %>%
dplyr::mutate(valley_group = ifelse(is.na(valley_group), 999, valley_group))
waves <- peaks_valleys %>%
dplyr::group_by(region, source, valley_group) %>%
dplyr::summarise(
n_days = dplyr::n(),
mean_median = mean(median, na.rm=T),
mean_lo95 = mean_median - 1.96 * (sd(median, na.rm=T) / n_days),
mean_hi95 = mean_median + 1.96 * (sd(median, na.rm=T) / n_days))
View(waves)
# Join peaks and valleys to full summary data
peaks_valleys <- summary %>%
dplyr::left_join(dplyr::select(peak_bind, region, date, source, peak = point),
by = c("region", "date", "source")) %>%
dplyr::left_join(dplyr::select(valley_bind, region, date, source, valley = point),
by = c("region", "date", "source")) %>%
dplyr::group_by(region, source) %>%
dplyr::mutate(date_n = seq_along(date),
peak_valley_type = ifelse(!is.na(peak), peak,
valley),
peak_valley_date = ifelse(!is.na(peak_valley_type), date_n, NA),
valley_start = ifelse(!is.na(valley), date_n, NA)) %>%
tidyr::fill(valley_start, .direction = "up") %>%
dplyr::mutate(valley_start = ifelse(is.na(valley_start), 999, valley_start))
waves <- peaks_valleys %>%
dplyr::group_by(region, source, valley_start) %>%
dplyr::summarise(
n_days = dplyr::n(),
mean_median = mean(median, na.rm=T),
mean_lo95 = mean_median - 1.96 * (sd(median, na.rm=T) / n_days),
mean_hi95 = mean_median + 1.96 * (sd(median, na.rm=T) / n_days))
# Join peaks and valleys to full summary data
peaks_valleys <- summary %>%
dplyr::left_join(dplyr::select(peak_bind, region, date, source, peak = point),
by = c("region", "date", "source")) %>%
dplyr::left_join(dplyr::select(valley_bind, region, date, source, valley = point),
by = c("region", "date", "source")) %>%
dplyr::group_by(region, source) %>%
dplyr::mutate(date_n = seq_along(date),
peak_valley_type = ifelse(!is.na(peak), peak,
valley),
peak_valley_date = ifelse(!is.na(peak_valley_type), date_n, NA),
valley_start = ifelse(!is.na(valley), date_n, NA)) %>%
tidyr::fill(valley_start, .direction = "down") %>%
dplyr::mutate(valley_start = ifelse(is.na(valley_start), 1, valley_start))
waves <- peaks_valleys %>%
dplyr::group_by(region, source, valley_start) %>%
dplyr::summarise(
n_days = dplyr::n(),
mean_median = mean(median, na.rm=T),
mean_lo95 = mean_median - 1.96 * (sd(median, na.rm=T) / n_days),
mean_hi95 = mean_median + 1.96 * (sd(median, na.rm=T) / n_days))
# Join peaks and valleys to full summary data
peaks_valleys <- summary %>%
dplyr::left_join(dplyr::select(peak_bind, region, date, source, peak = point),
by = c("region", "date", "source")) %>%
dplyr::left_join(dplyr::select(valley_bind, region, date, source, valley = point),
by = c("region", "date", "source")) %>%
dplyr::group_by(region, source) %>%
dplyr::mutate(date_n = seq_along(date),
peak_valley_type = ifelse(!is.na(peak), peak,
valley),
peak_valley_date = ifelse(!is.na(peak_valley_type), date_n, NA),
valley_start = ifelse(!is.na(valley), date_n, NA)) %>%
tidyr::fill(valley_start, .direction = "down") %>%
dplyr::mutate(valley_start = ifelse(is.na(valley_start), 1, valley_start),
peak_to_end = peak_valley_date - valley_start)
waves <- peaks_valleys %>%
dplyr::group_by(region, source, valley_start) %>%
dplyr::summarise(
n_days = dplyr::n(),
mean_median = mean(median, na.rm=T),
mean_lo95 = mean_median - 1.96 * (sd(median, na.rm=T) / n_days),
mean_hi95 = mean_median + 1.96 * (sd(median, na.rm=T) / n_days),
peak_to_valley = mean(peak_to_end, na.rm=T))
mean(c(0,10))
# Join peaks and valleys to full summary data
peaks_valleys <- summary %>%
dplyr::left_join(dplyr::select(peak_bind, region, date, source, peak = point),
by = c("region", "date", "source")) %>%
dplyr::left_join(dplyr::select(valley_bind, region, date, source, valley = point),
by = c("region", "date", "source")) %>%
dplyr::group_by(region, source) %>%
dplyr::mutate(date_n = seq_along(date),
peak_valley_type = ifelse(!is.na(peak), peak,
valley),
peak_valley_date = ifelse(!is.na(peak_valley_type), date_n, NA),
valley_start = ifelse(!is.na(valley), date_n, NA)) %>%
tidyr::fill(valley_start, .direction = "down") %>%
dplyr::mutate(valley_start = ifelse(is.na(valley_start), 1, valley_start),
peak_to_end = peak_valley_date - valley_start,
peak_to_end = ifelse(peak_to_end == 0, NA, peak_to_end))
waves <- peaks_valleys %>%
dplyr::group_by(region, source, valley_start) %>%
dplyr::summarise(
n_days = dplyr::n(),
mean_median = mean(median, na.rm=T),
mean_lo95 = mean_median - 1.96 * (sd(median, na.rm=T) / n_days),
mean_hi95 = mean_median + 1.96 * (sd(median, na.rm=T) / n_days),
peak_to_valley = mean(peak_to_end, na.rm=T))
# Join peaks and valleys to full summary data
peaks_valleys <- summary %>%
dplyr::left_join(dplyr::select(peak_bind, region, date, source, peak = point),
by = c("region", "date", "source")) %>%
dplyr::left_join(dplyr::select(valley_bind, region, date, source, valley = point),
by = c("region", "date", "source")) %>%
dplyr::group_by(region, source) %>%
dplyr::mutate(date_n = seq_along(date),
peak_valley_type = ifelse(!is.na(peak), peak,
valley),
peak_valley_date = ifelse(!is.na(peak_valley_type), date_n, NA),
peak_start = ifelse(!is.na(peak), date_n, NA)) %>%
tidyr::fill(peak_start, .direction = "down")
waves <- peaks_valleys %>%
dplyr::group_by(region, source, peak_start) %>%
dplyr::summarise(
n_days = dplyr::n(),
mean_median = mean(median, na.rm=T),
mean_lo95 = mean_median - 1.96 * (sd(median, na.rm=T) / n_days),
mean_hi95 = mean_median + 1.96 * (sd(median, na.rm=T) / n_days))
# Join peaks and valleys to full summary data
peaks_valleys <- summary %>%
dplyr::left_join(dplyr::select(peak_bind, region, date, source, peak = point),
by = c("region", "date", "source")) %>%
dplyr::left_join(dplyr::select(valley_bind, region, date, source, valley = point),
by = c("region", "date", "source")) %>%
dplyr::group_by(region, source) %>%
dplyr::mutate(date_n = seq_along(date),
peak_valley_type = ifelse(!is.na(peak), peak,
valley),
peak_valley_date = ifelse(!is.na(peak_valley_type), date_n, NA),
peak_start = ifelse(!is.na(peak), date_n, NA)) %>%
tidyr::fill(peak_start, .direction = "down") %>%
dplyr::mutate(peak_start = ifelse(is.na(peak_start), 1, peak_start))
waves <- peaks_valleys %>%
dplyr::group_by(region, source, peak_start) %>%
dplyr::summarise(
n_days = dplyr::n(),
mean_median = mean(median, na.rm=T),
mean_lo95 = mean_median - 1.96 * (sd(median, na.rm=T) / n_days),
mean_hi95 = mean_median + 1.96 * (sd(median, na.rm=T) / n_days))
57+(57/2)
# Join peaks and valleys to full summary data
peaks_valleys <- summary %>%
dplyr::left_join(dplyr::select(peak_bind, region, date, source, peak = point),
by = c("region", "date", "source")) %>%
dplyr::left_join(dplyr::select(valley_bind, region, date, source, valley = point),
by = c("region", "date", "source")) %>%
dplyr::group_by(region, source) %>%
dplyr::mutate(date_n = seq_along(date),
peak_valley_type = ifelse(!is.na(peak), peak,
valley),
peak_valley_date = ifelse(!is.na(peak_valley_type), date_n, NA),
peak_start = ifelse(!is.na(peak), date_n, NA)) %>%
tidyr::fill(peak_start, .direction = "down") %>%
dplyr::mutate(peak_start = ifelse(is.na(peak_start), 1, peak_start),
wave_midpt = ifelse(date_n == peak_start + round(peak_start/2),
date_n, NA))
75+(75/2)
75+round(75/2)
75/2
# Join peaks and valleys to full summary data
peaks_valleys <- summary %>%
dplyr::left_join(dplyr::select(peak_bind, region, date, source, peak = point),
by = c("region", "date", "source")) %>%
dplyr::left_join(dplyr::select(valley_bind, region, date, source, valley = point),
by = c("region", "date", "source")) %>%
dplyr::group_by(region, source) %>%
dplyr::mutate(date_n = seq_along(date),
peak_valley_type = ifelse(!is.na(peak), peak,
valley),
peak_valley_date = ifelse(!is.na(peak_valley_type), date_n, NA),
peak_start = ifelse(!is.na(peak), date_n, NA)) %>%
tidyr::fill(peak_start, .direction = "down") %>%
dplyr::mutate(peak_start = ifelse(is.na(peak_start), 1, peak_start))
waves <- peaks_valleys %>%
dplyr::group_by(region, source, peak_start) %>%
dplyr::summarise(
n_days = dplyr::n(),
mean_median = mean(median, na.rm=T),
mean_lo95 = mean_median - 1.96 * (sd(median, na.rm=T) / n_days),
mean_hi95 = mean_median + 1.96 * (sd(median, na.rm=T) / n_days))
# Join peaks and valleys to full summary data
peaks_valleys <- summary %>%
dplyr::left_join(dplyr::select(peak_bind, region, date, source, peak = point),
by = c("region", "date", "source")) %>%
dplyr::left_join(dplyr::select(valley_bind, region, date, source, valley = point),
by = c("region", "date", "source")) %>%
dplyr::group_by(region, source) %>%
dplyr::mutate(date_n = seq_along(date),
peak_valley_type = ifelse(!is.na(peak), peak,
valley),
peak_valley_date = ifelse(!is.na(peak_valley_type), date_n, NA),
peak_start = ifelse(!is.na(peak), date_n, NA)) %>%
tidyr::fill(peak_start, .direction = "down") %>%
dplyr::mutate(peak_start = ifelse(is.na(peak_start), 1, peak_start)) %>%
dplyr::group_by(region, source, peak_start) %>%
dplyr::mutate(n = dplyr::n())
# Join peaks and valleys to full summary data
peaks_valleys <- summary %>%
dplyr::left_join(dplyr::select(peak_bind, region, date, source, peak = point),
by = c("region", "date", "source")) %>%
dplyr::left_join(dplyr::select(valley_bind, region, date, source, valley = point),
by = c("region", "date", "source")) %>%
dplyr::group_by(region, source) %>%
dplyr::mutate(date_n = seq_along(date),
peak_valley_type = ifelse(!is.na(peak), peak,
valley),
peak_valley_date = ifelse(!is.na(peak_valley_type), date_n, NA),
peak_start = ifelse(!is.na(peak), date_n, NA)) %>%
tidyr::fill(peak_start, .direction = "down") %>%
dplyr::mutate(peak_start = ifelse(is.na(peak_start), 1, peak_start)) %>%
dplyr::group_by(region, source, peak_start) %>%
dplyr::mutate(n = dplyr::n(),
midpt = ifelse(date_n == peak_start + (n / 2), date_n, NA)) %>%
dplyr::tidyr::fill(midpt, .direction = "up")
# Join peaks and valleys to full summary data
peaks_valleys <- summary %>%
dplyr::left_join(dplyr::select(peak_bind, region, date, source, peak = point),
by = c("region", "date", "source")) %>%
dplyr::left_join(dplyr::select(valley_bind, region, date, source, valley = point),
by = c("region", "date", "source")) %>%
dplyr::group_by(region, source) %>%
dplyr::mutate(date_n = seq_along(date),
peak_valley_type = ifelse(!is.na(peak), peak,
valley),
peak_valley_date = ifelse(!is.na(peak_valley_type), date_n, NA),
peak_start = ifelse(!is.na(peak), date_n, NA)) %>%
tidyr::fill(peak_start, .direction = "down") %>%
dplyr::mutate(peak_start = ifelse(is.na(peak_start), 1, peak_start)) %>%
dplyr::group_by(region, source, peak_start) %>%
dplyr::mutate(n = dplyr::n(),
midpt = ifelse(date_n == peak_start + (n / 2), date_n, NA)) %>%
tidyr::fill(midpt, .direction = "up")
# Join peaks and valleys to full summary data
peaks_valleys <- summary %>%
dplyr::left_join(dplyr::select(peak_bind, region, date, source, peak = point),
by = c("region", "date", "source")) %>%
dplyr::left_join(dplyr::select(valley_bind, region, date, source, valley = point),
by = c("region", "date", "source")) %>%
dplyr::group_by(region, source) %>%
dplyr::mutate(date_n = seq_along(date),
peak_valley_type = ifelse(!is.na(peak), peak,
valley),
peak_valley_date = ifelse(!is.na(peak_valley_type), date_n, NA),
peak_start = ifelse(!is.na(peak), date_n, NA)) %>%
tidyr::fill(peak_start, .direction = "down") %>%
dplyr::mutate(peak_start = ifelse(is.na(peak_start), 1, peak_start)) %>%
dplyr::group_by(region, source, peak_start) %>%
dplyr::mutate(n = dplyr::n(),
midpt = ifelse(date_n == peak_start + (n / 2), date_n, NA))
1+(29/2)
# Join peaks and valleys to full summary data
peaks_valleys <- summary %>%
dplyr::left_join(dplyr::select(peak_bind, region, date, source, peak = point),
by = c("region", "date", "source")) %>%
dplyr::left_join(dplyr::select(valley_bind, region, date, source, valley = point),
by = c("region", "date", "source")) %>%
dplyr::group_by(region, source) %>%
dplyr::mutate(date_n = seq_along(date),
peak_valley_type = ifelse(!is.na(peak), peak,
valley),
peak_valley_date = ifelse(!is.na(peak_valley_type), date_n, NA),
peak_start = ifelse(!is.na(peak), date_n, NA)) %>%
tidyr::fill(peak_start, .direction = "down") %>%
dplyr::mutate(peak_start = ifelse(is.na(peak_start), 1, peak_start)) %>%
dplyr::group_by(region, source, peak_start) %>%
dplyr::mutate(n = dplyr::n(),
midpt = ifelse(date_n == peak_start + round(n / 2), date_n, NA))
165-157
# Join peaks and valleys to full summary data
peaks_valleys <- summary %>%
dplyr::left_join(dplyr::select(peak_bind, region, date, source, peak = point),
by = c("region", "date", "source")) %>%
dplyr::left_join(dplyr::select(valley_bind, region, date, source, valley = point),
by = c("region", "date", "source")) %>%
dplyr::group_by(region, source) %>%
dplyr::mutate(date_n = seq_along(date),
peak_valley_type = ifelse(!is.na(peak), peak,
valley),
peak_valley_date = ifelse(!is.na(peak_valley_type), date_n, NA),
peak_start = ifelse(!is.na(peak), date_n, NA)) %>%
tidyr::fill(peak_start, .direction = "down") %>%
dplyr::mutate(peak_start = ifelse(is.na(peak_start), 1, peak_start)) %>%
dplyr::group_by(region, source, peak_start) %>%
dplyr::mutate(n = dplyr::n(),
midpt = ifelse(date_n == peak_start + round(n / 2), date_n, NA),
peak_to_midpt = peak_start - midpt)
# Join peaks and valleys to full summary data
peaks_valleys <- summary %>%
dplyr::left_join(dplyr::select(peak_bind, region, date, source, peak = point),
by = c("region", "date", "source")) %>%
dplyr::left_join(dplyr::select(valley_bind, region, date, source, valley = point),
by = c("region", "date", "source")) %>%
dplyr::group_by(region, source) %>%
dplyr::mutate(date_n = seq_along(date),
peak_valley_type = ifelse(!is.na(peak), peak,
valley),
peak_valley_date = ifelse(!is.na(peak_valley_type), date_n, NA),
peak_start = ifelse(!is.na(peak), date_n, NA)) %>%
tidyr::fill(peak_start, .direction = "down") %>%
dplyr::mutate(peak_start = ifelse(is.na(peak_start), 1, peak_start)) %>%
dplyr::group_by(region, source, peak_start) %>%
dplyr::mutate(n = dplyr::n(),
midpt = ifelse(date_n == peak_start + round(n / 2), date_n, NA),
peak_to_midpt = midpt - peak_start)
75-30
waves <- peaks_valleys %>%
dplyr::group_by(region, source, peak_start) %>%
dplyr::summarise(
n_days = dplyr::n(),
mean_median = mean(median, na.rm=T),
mean_lo95 = mean_median - 1.96 * (sd(median, na.rm=T) / n_days),
mean_hi95 = mean_median + 1.96 * (sd(median, na.rm=T) / n_days))
View(waves)
# Join peaks and valleys to full summary data
peaks_valleys <- summary %>%
dplyr::left_join(dplyr::select(peak_bind, region, date, source, peak = point),
by = c("region", "date", "source")) %>%
dplyr::left_join(dplyr::select(valley_bind, region, date, source, valley = point),
by = c("region", "date", "source")) %>%
dplyr::group_by(region, source) %>%
dplyr::mutate(date_n = seq_along(date),
peak_valley_type = ifelse(!is.na(peak), peak,
valley),
peak_valley_date = ifelse(!is.na(peak_valley_type), date_n, NA),
peak_start = ifelse(!is.na(peak), date_n, NA)) %>%
tidyr::fill(peak_start, .direction = "down") %>%
dplyr::mutate(peak_start = ifelse(is.na(peak_start), 1, peak_start)) %>%
dplyr::group_by(region, source, peak_start) %>%
dplyr::mutate(n = dplyr::n(),
midpt = ifelse(date_n == peak_start + round(n / 2), date_n, NA),
peak_to_midpt = midpt - peak_start) %>%
tidyr::fill(midpt, .direction = "down") %>%
dplyr::mutate(midpt = ifelse(is.na(midpt), 0, midpt)) %>%
waves <- peaks_valleys %>%
dplyr::group_by(region, source, midpt) %>%
dplyr::summarise(
n_days = dplyr::n(),
mean_median = mean(median, na.rm=T),
mean_lo95 = mean_median - 1.96 * (sd(median, na.rm=T) / n_days),
mean_hi95 = mean_median + 1.96 * (sd(median, na.rm=T) / n_days))
# Join peaks and valleys to full summary data
peaks_valleys <- summary %>%
dplyr::left_join(dplyr::select(peak_bind, region, date, source, peak = point),
by = c("region", "date", "source")) %>%
dplyr::left_join(dplyr::select(valley_bind, region, date, source, valley = point),
by = c("region", "date", "source")) %>%
dplyr::group_by(region, source) %>%
dplyr::mutate(date_n = seq_along(date),
peak_valley_type = ifelse(!is.na(peak), peak,
valley),
peak_valley_date = ifelse(!is.na(peak_valley_type), date_n, NA),
peak_start = ifelse(!is.na(peak), date_n, NA)) %>%
tidyr::fill(peak_start, .direction = "down") %>%
dplyr::mutate(peak_start = ifelse(is.na(peak_start), 1, peak_start)) %>%
dplyr::group_by(region, source, peak_start) %>%
dplyr::mutate(n = dplyr::n(),
midpt = ifelse(date_n == peak_start + round(n / 2), date_n, NA),
peak_to_midpt = midpt - peak_start) %>%
tidyr::fill(midpt, .direction = "down") %>%
dplyr::mutate(midpt = ifelse(is.na(midpt), 0, midpt))
waves <- peaks_valleys %>%
dplyr::group_by(region, source, midpt) %>%
dplyr::summarise(
n_days = dplyr::n(),
mean_median = mean(median, na.rm=T),
mean_lo95 = mean_median - 1.96 * (sd(median, na.rm=T) / n_days),
mean_hi95 = mean_median + 1.96 * (sd(median, na.rm=T) / n_days))
waves <- peaks_valleys %>%
dplyr::group_by(region, source, midpt) %>%
dplyr::summarise(
n_days = dplyr::n(),
peak_start = mean(peak_start),
mean_median = mean(median, na.rm=T),
mean_lo95 = mean_median - 1.96 * (sd(median, na.rm=T) / n_days),
mean_hi95 = mean_median + 1.96 * (sd(median, na.rm=T) / n_days))
# Join peaks and valleys to full summary data
peaks_valleys <- summary %>%
dplyr::left_join(dplyr::select(peak_bind, region, date, source, peak = point),
by = c("region", "date", "source")) %>%
dplyr::left_join(dplyr::select(valley_bind, region, date, source, valley = point),
by = c("region", "date", "source")) %>%
dplyr::group_by(region, source) %>%
dplyr::mutate(date_n = seq_along(date),
peak_valley_type = ifelse(!is.na(peak), peak,
valley),
peak_valley_date = ifelse(!is.na(peak_valley_type), date_n, NA),
peak_start = ifelse(!is.na(peak), date_n, NA)) %>%
tidyr::fill(peak_start, .direction = "down") %>%
dplyr::mutate(peak_start = ifelse(is.na(peak_start), 1, peak_start)) %>%
dplyr::group_by(region, source, peak_start) %>%
dplyr::mutate(n = dplyr::n(),
midpt = ifelse(date_n == peak_start + round(n / 2), date_n, NA),
peak_to_midpt = midpt - peak_start) %>%
tidyr::fill(midpt, .direction = "down")
# Join peaks and valleys to full summary data
peaks_valleys <- summary %>%
dplyr::left_join(dplyr::select(peak_bind, region, date, source, peak = point),
by = c("region", "date", "source")) %>%
dplyr::left_join(dplyr::select(valley_bind, region, date, source, valley = point),
by = c("region", "date", "source")) %>%
dplyr::group_by(region, source) %>%
dplyr::mutate(date_n = seq_along(date),
peak_valley_type = ifelse(!is.na(peak), peak,
valley),
peak_valley_date = ifelse(!is.na(peak_valley_type), date_n, NA),
peak_start = ifelse(!is.na(peak), date_n, NA)) %>%
tidyr::fill(peak_start, .direction = "down") %>%
dplyr::mutate(peak_start = ifelse(is.na(peak_start), 1, peak_start)) %>%
dplyr::group_by(region, source, peak_start) %>%
dplyr::mutate(n = dplyr::n(),
midpt = ifelse(date_n == peak_start + round(n / 2), date_n, NA),
peak_to_midpt = midpt - peak_start) %>%
dplyr::ungroup() %>%
dplyr::group_by(region, source) %>%
tidyr::fill(midpt, .direction = "down")
# Join peaks and valleys to full summary data
peaks_valleys <- summary %>%
dplyr::left_join(dplyr::select(peak_bind, region, date, source, peak = point),
by = c("region", "date", "source")) %>%
dplyr::left_join(dplyr::select(valley_bind, region, date, source, valley = point),
by = c("region", "date", "source")) %>%
dplyr::group_by(region, source) %>%
dplyr::mutate(date_n = seq_along(date),
peak_valley_type = ifelse(!is.na(peak), peak,
valley),
peak_valley_date = ifelse(!is.na(peak_valley_type), date_n, NA),
peak_start = ifelse(!is.na(peak), date_n, NA)) %>%
tidyr::fill(peak_start, .direction = "down") %>%
dplyr::mutate(peak_start = ifelse(is.na(peak_start), 1, peak_start)) %>%
dplyr::group_by(region, source, peak_start) %>%
dplyr::mutate(n = dplyr::n(),
midpt = ifelse(date_n == peak_start + round(n / 2), date_n, NA),
peak_to_midpt = midpt - peak_start) %>%
dplyr::ungroup() %>%
dplyr::group_by(region, source) %>%
tidyr::fill(midpt, .direction = "down") %>%
dplyr::mutate(midpt = ifelse(is.na(midpt), 1, midpt))
waves <- peaks_valleys %>%
dplyr::group_by(region, source, midpt) %>%
dplyr::summarise(
n_days = dplyr::n(),
peak_start = mean(peak_start),
mean_median = mean(median, na.rm=T),
mean_lo95 = mean_median - 1.96 * (sd(median, na.rm=T) / n_days),
mean_hi95 = mean_median + 1.96 * (sd(median, na.rm=T) / n_days))
waves <- peaks_valleys %>%
dplyr::group_by(region, source, midpt) %>%
dplyr::summarise(
n_days = dplyr::n(),
mean_median = mean(median, na.rm=T),
mean_lo95 = mean_median - 1.96 * (sd(median, na.rm=T) / n_days),
mean_hi95 = mean_median + 1.96 * (sd(median, na.rm=T) / n_days))
# wave split
wave_split <- split(waves, waves$region) %>%
purrr::map(., ~ split(., .$source))
View(wave_split)
wave_split[["England"]]
wave_split[["England"]]
t.test(wave_split$England$cases_test$mean_median)
# 14 , 108 - 4th april to 4th july
# Epinow2, PR #74
remotes::install_github("epiforecasts/EpiNow2#74")
# Epinow2, PR #74
remotes::install_github("epiforecasts/EpiNow2")
# Epinow2, PR #74
remotes::install_github("epiforecasts/EpiNow2")
# Epinow2, PR #74
remotes::install_github("epiforecasts/EpiNow2")
detach(data.table)
detach("data.table")
rm(list=ls())
