"Northamptonshire" = "East Midlands",
"Nottinghamshire" = "East Midlands",
"Oxfordshire" = "South East",
"Somerset" = "South West",
"Staffordshire" = "West Midlands",
"Suffolk" = "East of England",
"Surrey" = "South East",
"Warwickshire" = "West Midlands",
"West Sussex" = "South East",
"Worcestershire" = "West Midlands") %>%
dplyr::bind_rows() %>%
dplyr::add_rownames()
# la_to_region
region_fix <- list(
"England" = "England",
"Buckinghamshire" = "South East",
"Cambridgeshire" = "East of England",
"Derbyshire" = "East Midlands",
"Cumbria" = "North West",
"Devon" = "South West",
"East Sussex" = "South East",
"Essex" = "South East",
"Gloucestershire" = "South West",
"Hampshire" = "South East",
"Hertfordshire" = "East of England",
"Kent" = "South East",
"Lancashire" = "North West",
"Leicestershire" = "East Midlands",
"Lincolnshire" = "Yorkshire and the Humber",
"Norfolk" = "East of England",
"North Yorkshire" = "Yorkshire and the Humber",
"Northamptonshire" = "East Midlands",
"Nottinghamshire" = "East Midlands",
"Oxfordshire" = "South East",
"Somerset" = "South West",
"Staffordshire" = "West Midlands",
"Suffolk" = "East of England",
"Surrey" = "South East",
"Warwickshire" = "West Midlands",
"West Sussex" = "South East",
"Worcestershire" = "West Midlands") %>%
dplyr::bind_rows() %>%
dplyr::add_rownames()
"England" = "England",
"Buckinghamshire" = "South East",
"Cambridgeshire" = "East of England",
"Derbyshire" = "East Midlands",
"Cumbria" = "North West",
"Devon" = "South West",
"East Sussex" = "South East",
"Essex" = "South East",
"Gloucestershire" = "South West",
"Hampshire" = "South East",
"Hertfordshire" = "East of England",
"Kent" = "South East",
"Lancashire" = "North West",
"Leicestershire" = "East Midlands",
"Lincolnshire" = "Yorkshire and the Humber",
"Norfolk" = "East of England",
"North Yorkshire" = "Yorkshire and the Humber",
"Northamptonshire" = "East Midlands",
"Nottinghamshire" = "East Midlands",
"Oxfordshire" = "South East",
"Somerset" = "South West",
"Staffordshire" = "West Midlands",
"Suffolk" = "East of England",
"Surrey" = "South East",
"Warwickshire" = "West Midlands",
"West Sussex" = "South East",
"Worcestershire" = "West Midlands") %>%
dplyr::bind_rows() %>%
dplyr::add_row(names(.))
# la_to_region
region_fix <- list(
"England" = "England",
"Buckinghamshire" = "South East",
"Cambridgeshire" = "East of England",
"Derbyshire" = "East Midlands",
"Cumbria" = "North West",
"Devon" = "South West",
"East Sussex" = "South East",
"Essex" = "South East",
"Gloucestershire" = "South West",
"Hampshire" = "South East",
"Hertfordshire" = "East of England",
"Kent" = "South East",
"Lancashire" = "North West",
"Leicestershire" = "East Midlands",
"Lincolnshire" = "Yorkshire and the Humber",
"Norfolk" = "East of England",
"North Yorkshire" = "Yorkshire and the Humber",
"Northamptonshire" = "East Midlands",
"Nottinghamshire" = "East Midlands",
"Oxfordshire" = "South East",
"Somerset" = "South West",
"Staffordshire" = "West Midlands",
"Suffolk" = "East of England",
"Surrey" = "South East",
"Warwickshire" = "West Midlands",
"West Sussex" = "South East",
"Worcestershire" = "West Midlands") %>%
dplyr::bind_rows() %>%
dplyr::add_row(names(.))
"England" = "England",
"Buckinghamshire" = "South East",
"Cambridgeshire" = "East of England",
"Derbyshire" = "East Midlands",
"Cumbria" = "North West",
"Devon" = "South West",
"East Sussex" = "South East",
"Essex" = "South East",
"Gloucestershire" = "South West",
"Hampshire" = "South East",
"Hertfordshire" = "East of England",
"Kent" = "South East",
"Lancashire" = "North West",
"Leicestershire" = "East Midlands",
"Lincolnshire" = "Yorkshire and the Humber",
"Norfolk" = "East of England",
"North Yorkshire" = "Yorkshire and the Humber",
"Northamptonshire" = "East Midlands",
"Nottinghamshire" = "East Midlands",
"Oxfordshire" = "South East",
"Somerset" = "South West",
"Staffordshire" = "West Midlands",
"Suffolk" = "East of England",
"Surrey" = "South East",
"Warwickshire" = "West Midlands",
"West Sussex" = "South East",
"Worcestershire" = "West Midlands") %>%
dplyr::bind_rows() %>%
dplyr::add_row(names())
# la_to_region
region_fix <- list(
"England" = "England",
"Buckinghamshire" = "South East",
"Cambridgeshire" = "East of England",
"Derbyshire" = "East Midlands",
"Cumbria" = "North West",
"Devon" = "South West",
"East Sussex" = "South East",
"Essex" = "South East",
"Gloucestershire" = "South West",
"Hampshire" = "South East",
"Hertfordshire" = "East of England",
"Kent" = "South East",
"Lancashire" = "North West",
"Leicestershire" = "East Midlands",
"Lincolnshire" = "Yorkshire and the Humber",
"Norfolk" = "East of England",
"North Yorkshire" = "Yorkshire and the Humber",
"Northamptonshire" = "East Midlands",
"Nottinghamshire" = "East Midlands",
"Oxfordshire" = "South East",
"Somerset" = "South West",
"Staffordshire" = "West Midlands",
"Suffolk" = "East of England",
"Surrey" = "South East",
"Warwickshire" = "West Midlands",
"West Sussex" = "South East",
"Worcestershire" = "West Midlands") %>%
dplyr::bind_rows() %>%
dplyr::add_row(names())
# la_to_region
region_fix <- list(
"England" = "England",
"Buckinghamshire" = "South East",
"Cambridgeshire" = "East of England",
"Derbyshire" = "East Midlands",
"Cumbria" = "North West",
"Devon" = "South West",
"East Sussex" = "South East",
"Essex" = "South East",
"Gloucestershire" = "South West",
"Hampshire" = "South East",
"Hertfordshire" = "East of England",
"Kent" = "South East",
"Lancashire" = "North West",
"Leicestershire" = "East Midlands",
"Lincolnshire" = "Yorkshire and the Humber",
"Norfolk" = "East of England",
"North Yorkshire" = "Yorkshire and the Humber",
"Northamptonshire" = "East Midlands",
"Nottinghamshire" = "East Midlands",
"Oxfordshire" = "South East",
"Somerset" = "South West",
"Staffordshire" = "West Midlands",
"Suffolk" = "East of England",
"Surrey" = "South East",
"Warwickshire" = "West Midlands",
"West Sussex" = "South East",
"Worcestershire" = "West Midlands") %>%
dplyr::bind_rows()
region_fix[2,] <- colnames(region_fix)
region_fix[2,] <- t(colnames(region_fix))\
region_fix[2,] <- t(colnames(region_fix))
View(region_fix)
"England" = "England",
"Buckinghamshire" = "South East",
"Cambridgeshire" = "East of England",
"Derbyshire" = "East Midlands",
"Cumbria" = "North West",
"Devon" = "South West",
"East Sussex" = "South East",
"Essex" = "South East",
"Gloucestershire" = "South West",
"Hampshire" = "South East",
"Hertfordshire" = "East of England",
"Kent" = "South East",
"Lancashire" = "North West",
"Leicestershire" = "East Midlands",
"Lincolnshire" = "Yorkshire and the Humber",
"Norfolk" = "East of England",
"North Yorkshire" = "Yorkshire and the Humber",
"Northamptonshire" = "East Midlands",
"Nottinghamshire" = "East Midlands",
"Oxfordshire" = "South East",
"Somerset" = "South West",
"Staffordshire" = "West Midlands",
"Suffolk" = "East of England",
"Surrey" = "South East",
"Warwickshire" = "West Midlands",
"West Sussex" = "South East",
"Worcestershire" = "West Midlands") %>%
dplyr::bind_rows() %>%
t()
# la_to_region
region_fix <- list(
"England" = "England",
"Buckinghamshire" = "South East",
"Cambridgeshire" = "East of England",
"Derbyshire" = "East Midlands",
"Cumbria" = "North West",
"Devon" = "South West",
"East Sussex" = "South East",
"Essex" = "South East",
"Gloucestershire" = "South West",
"Hampshire" = "South East",
"Hertfordshire" = "East of England",
"Kent" = "South East",
"Lancashire" = "North West",
"Leicestershire" = "East Midlands",
"Lincolnshire" = "Yorkshire and the Humber",
"Norfolk" = "East of England",
"North Yorkshire" = "Yorkshire and the Humber",
"Northamptonshire" = "East Midlands",
"Nottinghamshire" = "East Midlands",
"Oxfordshire" = "South East",
"Somerset" = "South West",
"Staffordshire" = "West Midlands",
"Suffolk" = "East of England",
"Surrey" = "South East",
"Warwickshire" = "West Midlands",
"West Sussex" = "South East",
"Worcestershire" = "West Midlands") %>%
dplyr::bind_rows() %>%
t()
"England" = "England",
"Buckinghamshire" = "South East",
"Cambridgeshire" = "East of England",
"Derbyshire" = "East Midlands",
"Cumbria" = "North West",
"Devon" = "South West",
"East Sussex" = "South East",
"Essex" = "South East",
"Gloucestershire" = "South West",
"Hampshire" = "South East",
"Hertfordshire" = "East of England",
"Kent" = "South East",
"Lancashire" = "North West",
"Leicestershire" = "East Midlands",
"Lincolnshire" = "Yorkshire and the Humber",
"Norfolk" = "East of England",
"North Yorkshire" = "Yorkshire and the Humber",
"Northamptonshire" = "East Midlands",
"Nottinghamshire" = "East Midlands",
"Oxfordshire" = "South East",
"Somerset" = "South West",
"Staffordshire" = "West Midlands",
"Suffolk" = "East of England",
"Surrey" = "South East",
"Warwickshire" = "West Midlands",
"West Sussex" = "South East",
"Worcestershire" = "West Midlands") %>%
dplyr::bind_rows() %>%
t() %>%
tibble::rownames_to_column(var = "region")
# la_to_region
region_fix <- list(
"England" = "England",
"Buckinghamshire" = "South East",
"Cambridgeshire" = "East of England",
"Derbyshire" = "East Midlands",
"Cumbria" = "North West",
"Devon" = "South West",
"East Sussex" = "South East",
"Essex" = "South East",
"Gloucestershire" = "South West",
"Hampshire" = "South East",
"Hertfordshire" = "East of England",
"Kent" = "South East",
"Lancashire" = "North West",
"Leicestershire" = "East Midlands",
"Lincolnshire" = "Yorkshire and the Humber",
"Norfolk" = "East of England",
"North Yorkshire" = "Yorkshire and the Humber",
"Northamptonshire" = "East Midlands",
"Nottinghamshire" = "East Midlands",
"Oxfordshire" = "South East",
"Somerset" = "South West",
"Staffordshire" = "West Midlands",
"Suffolk" = "East of England",
"Surrey" = "South East",
"Warwickshire" = "West Midlands",
"West Sussex" = "South East",
"Worcestershire" = "West Midlands") %>%
dplyr::bind_rows() %>%
t() %>%
tibble::rownames_to_column(var = "region")
# la_to_region
region_fix <- list(
"England" = "England",
"Buckinghamshire" = "South East",
"Cambridgeshire" = "East of England",
"Derbyshire" = "East Midlands",
"Cumbria" = "North West",
"Devon" = "South West",
"East Sussex" = "South East",
"Essex" = "South East",
"Gloucestershire" = "South West",
"Hampshire" = "South East",
"Hertfordshire" = "East of England",
"Kent" = "South East",
"Lancashire" = "North West",
"Leicestershire" = "East Midlands",
"Lincolnshire" = "Yorkshire and the Humber",
"Norfolk" = "East of England",
"North Yorkshire" = "Yorkshire and the Humber",
"Northamptonshire" = "East Midlands",
"Nottinghamshire" = "East Midlands",
"Oxfordshire" = "South East",
"Somerset" = "South West",
"Staffordshire" = "West Midlands",
"Suffolk" = "East of England",
"Surrey" = "South East",
"Warwickshire" = "West Midlands",
"West Sussex" = "South East",
"Worcestershire" = "West Midlands") %>%
dplyr::bind_rows() %>%
t()
tibble::rownames_to_column(region_fix, var = "region")
tibble::rownames_to_column(as.data.frame(region_fix), var = "region")
region_fix <- tibble::rownames_to_column(as.data.frame(region_fix), var = "region")
View(region_fix)
# la_to_region
region_fix <- list(
"England" = "England",
"Buckinghamshire" = "South East",
"Cambridgeshire" = "East of England",
"Derbyshire" = "East Midlands",
"Cumbria" = "North West",
"Devon" = "South West",
"East Sussex" = "South East",
"Essex" = "South East",
"Gloucestershire" = "South West",
"Hampshire" = "South East",
"Hertfordshire" = "East of England",
"Kent" = "South East",
"Lancashire" = "North West",
"Leicestershire" = "East Midlands",
"Lincolnshire" = "Yorkshire and the Humber",
"Norfolk" = "East of England",
"North Yorkshire" = "Yorkshire and the Humber",
"Northamptonshire" = "East Midlands",
"Nottinghamshire" = "East Midlands",
"Oxfordshire" = "South East",
"Somerset" = "South West",
"Staffordshire" = "West Midlands",
"Suffolk" = "East of England",
"Surrey" = "South East",
"Warwickshire" = "West Midlands",
"West Sussex" = "South East",
"Worcestershire" = "West Midlands") %>%
dplyr::bind_rows() %>%
t()
region_fix <- tibble::rownames_to_column(as.data.frame(region_fix), var = "LAD19NM") %>%
dplyr::rename("RGN19NM" = "V1")
View(region_fix)
la_to_region <- dplyr::bind_rows(la_to_region, region_fix)
# Join to carehome data
carehome_la <- dplyr::left_join(carehome_la, la_to_region, by = c("local_auth" = "LAD19NM"))
la_na <- unique(carehome_la[is.na(carehome_la$RGN19NM),1])
View(carehome_la)
rm(list=ls())
url <- "https://www.ons.gov.uk/file?uri=%2fpeoplepopulationandcommunity%2fbirthsdeathsandmarriages%2fdeaths%2fdatasets%2fnumberofdeathsincarehomesnotifiedtothecarequalitycommissionengland%2f2020/20200913officialsensitivecoviddeathnotificationsdata20200911v1.xlsx"
httr::GET(url, httr::write_disk(tf <- tempfile(fileext = ".xlsx")))
sheets <- readxl::excel_sheets(tf)
# # Regional pillar 2
carehome_eng <- readxl::read_excel(path = tf,
sheet = 3,
range = readxl::cell_limits(c(3,1), c(NA, NA)))
carehome_la <- readxl::read_excel(path = tf,
sheet = 4,
range = readxl::cell_limits(c(3,1), c(NA, NA))) %>%
dplyr::rename("local_auth" = "...1") %>%
tidyr::pivot_longer(-local_auth, names_to = "date", values_to = "deaths") %>%
dplyr::mutate(date = lubridate::as_date(as.numeric(date), origin = lubridate::origin))
# Convert LAD to regions
la_to_region <- readr::read_csv("https://opendata.arcgis.com/datasets/3ba3daf9278f47daba0f561889c3521a_0.csv") %>%
dplyr::select("LAD19NM", "RGN19NM")
# fix some missin ones
region_fix <- list(
"England" = "England",
"Buckinghamshire" = "South East",
"Cambridgeshire" = "East of England",
"Derbyshire" = "East Midlands",
"Cumbria" = "North West",
"Devon" = "South West",
"East Sussex" = "South East",
"Essex" = "South East",
"Gloucestershire" = "South West",
"Hampshire" = "South East",
"Hertfordshire" = "East of England",
"Kent" = "South East",
"Lancashire" = "North West",
"Leicestershire" = "East Midlands",
"Lincolnshire" = "Yorkshire and the Humber",
"Norfolk" = "East of England",
"North Yorkshire" = "Yorkshire and the Humber",
"Northamptonshire" = "East Midlands",
"Nottinghamshire" = "East Midlands",
"Oxfordshire" = "South East",
"Somerset" = "South West",
"Staffordshire" = "West Midlands",
"Suffolk" = "East of England",
"Surrey" = "South East",
"Warwickshire" = "West Midlands",
"West Sussex" = "South East",
"Worcestershire" = "West Midlands") %>%
dplyr::bind_rows() %>%
t()
region_fix <- tibble::rownames_to_column(as.data.frame(region_fix), var = "LAD19NM") %>%
dplyr::rename("RGN19NM" = "V1")
la_to_region <- dplyr::bind_rows(la_to_region, region_fix)
# Join to carehome data
carehome_la <- dplyr::left_join(carehome_la, la_to_region, by = c("local_auth" = "LAD19NM"))
la_na <- unique(carehome_la[is.na(carehome_la$RGN19NM),1])
View(carehome_la)
View(la_na)
carehome_la <- dplyr::filter(carehome_la, !is.na(RGN19NM))
View(carehome_eng)
View(carehome_la)
carehome_region <- carehome_la %>%
dplyr::rename("region" =  "RGN19NM") %>%
dplyr::mutate(region = ifelse(region = "East Midlands" | region = "West Midlands",
"Midlands", region),
region = ifelse(region = "North East" | region = "Yorkshire and the Humber",
"North East and Yorkshire", region)) %>%
dplyr::group_by(region, date) %>%
dplyr::summarise(deaths = sum(deaths))
carehome_region <- carehome_la %>%
dplyr::mutate(region = ifelse(RGN19NM = "East Midlands" | RGN19NM = "West Midlands",
"Midlands", RGN19NM),
region = ifelse(region = "North East" | RGN19NM = "Yorkshire and the Humber",
"North East and Yorkshire", region)) %>%
dplyr::group_by(region, date) %>%
dplyr::summarise(deaths = sum(deaths))
carehome_region <- carehome_la %>%
dplyr::mutate(region = ifelse(RGN19NM == "East Midlands" | RGN19NM == "West Midlands",
"Midlands", RGN19NM),
region = ifelse(region == "North East" | RGN19NM == "Yorkshire and the Humber",
"North East and Yorkshire", region)) %>%
dplyr::group_by(region, date) %>%
dplyr::summarise(deaths = sum(deaths))
View(carehome_region)
unique(carehome_region$region)
rm(list=ls())
source('~/.active-rstudio-document', echo=TRUE)
View(carehome_region)
unique(carehome_region$region)
carehome_region <- carehome_la %>%
dplyr::mutate(region = ifelse(RGN19NM == "East Midlands" | RGN19NM == "West Midlands",
"Midlands", RGN19NM),
region = ifelse(region == "North East" | RGN19NM == "Yorkshire and The Humber",
"North East and Yorkshire", region)) %>%
dplyr::group_by(region, date) %>%
dplyr::summarise(deaths = sum(deaths), .groups = "drop")
View(carehome_region)
unique(carehome_region$region)
qplot(x = carehome_region[carehome_region$region == "England"], y = carehome_region$deaths)
plot(x = carehome_region[carehome_region$region == "England"], y = carehome_region$deaths)
plot(x = carehome_region[carehome_region$region == "England",2], y = carehome_region[carehome_region$region == "England",3)
plot(x = carehome_region[carehome_region$region == "England",2], y = carehome_region[carehome_region$region == "England",3])
#
#
carehome_eng <- carehome_region[carehome_region == "England",]
#
#
carehome_eng <- carehome_region[carehome_region$region == "England",]
plot(carehome_eng$date, carehome_eng$deaths)
plot(carehome_eng$date, carehome_eng$deaths, lty=1)
plot(carehome_eng$date, carehome_eng$deaths, lty=2)
View(carehome_region)
# Get count data ----------------------------------------------------------
# If data won't download, read in a saved hard copy of cleaned data - 23 August 2020
if(class(try(source(here::here("data", "get-uk-data.R")))) == "try-error") {
message("--- API failure - loading saved data ---")
data <- readRDS("data/200914.rds")
} else {
source(here::here("data", "get-uk-data.R"))
}
View(data)
